{% trans_default_domain 'calendar' %}

{% if calendar is not empty %}
    {% set week_management = is_granted('WLT_AGREEMENT_LOCK', agreement) %}
    {% set day_width = week_management ? 16 : 20 %}
    <div class="row">
    {% for num, month in calendar %}
        <div class="col-sm">
            <div class="table-responsive">
                <table class="calendar table table-bordered table-condensed table-hover">
                    <thead>
                    <tr>
                        {% set year = num//12 %}
                        <th colspan="{{ week_management ? 6 : 5 }}" class="calendar-month">{{ ('month'~(num % 12))|trans({}, 'calendar') }} {{ year }}</th>
                    </tr>
                    <tr>
                        {% if week_management %}
                            <th class="w-20"></th>
                        {% endif %}
                        <th class="w-{{ day_width }}">{{ 'dow0'|trans({}, 'calendar') }}</th>
                        <th class="w-{{ day_width }}">{{ 'dow1'|trans({}, 'calendar') }}</th>
                        <th class="w-{{ day_width }}">{{ 'dow2'|trans({}, 'calendar') }}</th>
                        <th class="w-{{ day_width }}">{{ 'dow3'|trans({}, 'calendar') }}</th>
                        <th class="w-{{ day_width }}">{{ 'dow4'|trans({}, 'calendar') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for week in month %}
                        <tr>
                            {% if week_management %}
                                <td class="w-20 operations align-middle">
                                    <a href="" class="" title="{{ 'form.lock_week_action'|trans }}"><i class="fas fa-lock fa-fw"></i></a>
                                    <a href="" class="" title="{{ 'form.unlock_week_action'|trans }}"><i class="fas fa-unlock fa-fw"></i></a>
                                    <a href="" class="" title="{{ 'form.activity_report'|trans }}"><i class="fas fa-print fa-fw"></i></a>
                                </td>
                            {% endif %}
                            {% for n, dayData in week.days %}
                                {% set day = dayData ? dayData[0] : null %}
                                {% if loop.index < 6 %}
                                {% block day %}
                                <td class="w-{{ day_width }}{% if day %} workday{% endif %}">
                                    {% if day %}
                                        <b>{{ n }}</b><br/>
                                        {{ 'caption.hours'|transchoice(day.hours) }}
                                    {% elseif n > 0 %}
                                        {{ n }}
                                    {% endif %}
                                </td>
                                {% endblock %}
                                {% endif %}
                            {% endfor %}
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% if not loop.first and loop.index is divisible by(2) and not loop.last %}
    </div>
    <div class="row">
    {% endif %}
    {% endfor %}
    {% if (calendar|length % 2) > 0 %}
        {% for i in range((calendar|length % 2), 1) %}
            <div class="col-sm"></div>
        {% endfor %}
    {% endif %}
    </div>
{% else %}
    <div class="alert alert-warning">{{ 'prompt.empty'|trans({}, 'calendar')|nl2br }}</div>
{% endif %}
